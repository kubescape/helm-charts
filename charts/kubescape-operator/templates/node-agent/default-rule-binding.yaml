{{- if and .Values.alertCRD.installDefault .Values.alertCRD.scopeClustered }}
apiVersion: kubescape.io/v1
kind: RuntimeRuleAlertBinding
metadata:
  name: all-rules-all-pods
  annotations:
    {{- include "kubescape-operator.annotations" (dict "Values" .Values) | nindent 4 }}
  labels:
    {{- include "kubescape-operator.labels" (dict "Chart" .Chart "Release" .Release "Values" .Values "app" .Values.nodeAgent.name "tier" .Values.global.namespaceTier) | nindent 4 }}
spec:
  namespaceSelector:
    matchExpressions:
      {{- if ne .Values.includeNamespaces "" }}
      - key: "kubernetes.io/metadata.name"
        operator: "In"
        values:
          {{- $namespaces := split "," .Values.includeNamespaces }}
          {{- range $namespaces }}
          - {{ . | quote }}
          {{- end }}
      {{- else if ne .Values.excludeNamespaces "" }}
      - key: "kubernetes.io/metadata.name"
        operator: "NotIn"
        values:
          {{- $namespaces := split "," .Values.excludeNamespaces }}
          {{- range $namespaces }}
          - {{ . | quote }}
          {{- end }}
      {{- end }}
  rules:
    - ruleName: "Unexpected process launched"
    - ruleName: "Files Access Anomalies in container"
    - ruleName: "Syscalls Anomalies in container"
    - ruleName: "Linux Capabilities Anomalies in container"
    - ruleName: "DNS Anomalies in container"
    - ruleName: "Unexpected service account token access"
    - ruleName: "Workload uses Kubernetes API unexpectedly"
    - ruleName: "Process executed from malicious source"
    - ruleName: "Process tries to load a kernel module"
    - ruleName: "Drifted process executed"
    - ruleName: "Disallowed ssh connection"
    - ruleName: "Fileless execution detected"
    - ruleName: "Crypto miner launched"
    - ruleName: "Process executed from mount"
    - ruleName: "Crypto Mining Related Port Communication"
    - ruleName: "Crypto Mining Domain Communication"
    - ruleName: "Read Environment Variables from procfs"
    - ruleName: "eBPF Program Load"
    - ruleName: "Soft link created over sensitive file"
    - ruleName: "Unexpected Sensitive File Access"
    - ruleName: "Hard link created over sensitive file"
    - ruleName: "Exec to pod"
    - ruleName: "Port forward"
    - ruleName: "Unexpected Egress Network Traffic"
    - ruleName: "Malicious Ptrace Usage"
    - ruleName: "Unexpected io_uring Operation Detected"
{{- end }}
