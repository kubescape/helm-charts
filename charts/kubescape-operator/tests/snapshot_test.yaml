suite: Snapshot tests
tests:
  - it: all capabilities
    asserts:
      - matchSnapshot: {}
    capabilities:
      apiVersions:
        - batch/v1
    set:
      account: 9e6c0c2c-6bd0-4919-815b-55030de7c9a0
      accessKey: f304d73b-d43c-412b-82ea-e4c859493ce6
      capabilities:
        configurationScan: enable
        continuousScan: enable
        nodeScan: enable
        vulnerabilityScan: enable
        relevancy: enable
        vexGeneration: enable
        runtimeObservability: enable
        networkPolicyService: enable
        runtimeDetection: enable
        malwareDetection: enable
        nodeProfileService: enable
        autoUpgrading: enable
        prometheusExporter: enable
      server: api.armosec.io
      configurations.otelUrl: "otelCollector:4317"
      clusterName: kind-kind
      global:
        networkPolicy:
          createEgressRules: true
          enabled: true
        proxySecretFile: foo
      grypeOfflineDB.enabled: true
      kubescape.serviceMonitor.enabled: true
      kubescapeScheduler.scanSchedule: "1 2 3 4 5"
      kubevulnScheduler.scanSchedule: "1 2 3 4 5"
  - it: minimal capabilities
    asserts:
      - matchSnapshot: {}
    capabilities:
      apiVersions:
        - batch/v1
    set:
      configurations.otelUrl: "otelCollector:4317"
      clusterName: kind-kind
      kubescapeScheduler.scanSchedule: "1 2 3 4 5"
      kubevulnScheduler.scanSchedule: "1 2 3 4 5"
  - it: default capabilities
    asserts:
      - matchSnapshot: {}
    capabilities:
      apiVersions:
        - batch/v1
    set:
      account: 9e6c0c2c-6bd0-4919-815b-55030de7c9a0
      accessKey: f304d73b-d43c-412b-82ea-e4c859493ce6
      capabilities:
        configurationScan: enable
        continuousScan: disable
        nodeScan: enable
        vulnerabilityScan: enable
        relevancy: enable
        vexGeneration: disable
        runtimeObservability: enable
        networkPolicyService: enable
        runtimeDetection: disable
        malwareDetection: disable
        nodeProfileService: disable
        autoUpgrading: disable
        prometheusExporter: disable
      server: api.armosec.io
      configurations.otelUrl: "otelCollector:4317"
      clusterName: kind-kind
      global:
        networkPolicy:
          createEgressRules: true
          enabled: true
        proxySecretFile: foo
      grypeOfflineDB.enabled: true
      kubescape.serviceMonitor.enabled: true
      kubescapeScheduler.scanSchedule: "1 2 3 4 5"
      kubevulnScheduler.scanSchedule: "1 2 3 4 5"
  - it: with single private registry credentials
    template: configs/private-registries-creds-secret.yaml
    documentSelector:
      path: metadata.name
      value: kubescape-registry-scan-secrets
    asserts:
      - equal:
          path: metadata.name
          value: kubescape-registry-scan-secrets
      - matchSnapshot: {}
    capabilities:
      apiVersions:
        - batch/v1
    set:
      configurations.otelUrl: "otelCollector:4317"
      clusterName: kind-kind
      imageScanning:
        privateRegistries:
          credentials:
            - registry: foo.example.com
              username: bar
              password: baz
  - it: with multiple private registry credentials
    template: configs/private-registries-creds-secret.yaml
    documentSelector:
      path: metadata.name
      value: kubescape-registry-scan-secrets
    asserts:
      - equal:
          path: metadata.name
          value: kubescape-registry-scan-secrets
      - matchSnapshot: {}
    capabilities:
      apiVersions:
        - batch/v1
    set:
      configurations.otelUrl: "otelCollector:4317"
      clusterName: kind-kind
      imageScanning:
        privateRegistries:
          credentials:
            - registry: foo.example.com
              username: bar
              password: baz
              skipTlsVerify: true
            - registry: test.example.com
              username: xxx
              password: yyy
              insecure: true
