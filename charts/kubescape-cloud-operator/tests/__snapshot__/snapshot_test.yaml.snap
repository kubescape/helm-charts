matches the snapshot:
  1: |
    raw: |
      Thank you for installing kubescape-cloud-operator version 1.14.5.

      You can see and change the values of your's recurring configurations daily scan in the following link:
      https://cloud.armosec.io/settings/assets/clusters/scheduled-scans?cluster=kind-kind
      > kubectl -n kubescape get cj kubescape-scheduler -o=jsonpath='{.metadata.name}{"\t"}{.spec.schedule}{"\n"}'

      You can see and change the values of your's recurring images daily scan in the following link:
      https://cloud.armosec.io/settings/assets/images
      > kubectl -n kubescape get cj kubevuln-scheduler -o=jsonpath='{.metadata.name}{"\t"}{.spec.schedule}{"\n"}'

      See you!!!
  2: |
    apiVersion: v1
    data:
      clusterData: "{\n  \"gatewayWebsocketURL\": \"gateway:8001\",\n  \"gatewayRestURL\": \"gateway:8002\",\n  \"vulnScanURL\": \"kubevuln:8080\",\n  \"kubevulnURL\": \"kubevuln:8080\",\n  \"kubescapeURL\": \"kubescape:8080\",\n  \"triggerNewImageScan\": \"false\",\n  \"accountID\": \"9e6c0c2c-6bd0-4919-815b-55030de7c9a0\",\n  \"clusterName\": \"kind-kind\",\n  \"storage\": true,\n  \"relevantImageVulnerabilitiesEnabled\": true,\n  \"namespace\": \"kubescape\",\n  \"imageVulnerabilitiesScanningEnabled\": true,\n  \"postureScanEnabled\": true,\n  \"otelCollector\": true,\n  \"nodeAgent\": \"true\",\n  \"maxImageSize\": 5.36870912e+09,\n  \"keepLocal\": false,\n  \"scanTimeout\": \"5m\",\n  \"relevantImageVulnerabilitiesConfiguration\": \"enable\",\n  \"clusterProvider\": \"\",\n  \"listingURL\": \"http://grype-offline-db:80/listing.json\", \n  \"backendOpenAPI\": \"https://api.armosec.io/api\",\n  \"eventReceiverRestURL\": \"https://report.armo.cloud\",\n  \"eventReceiverWebsocketURL\": \"wss://report.armo.cloud\",\n  \"rootGatewayURL\": \"wss://ens.euprod1.cyberarmorsoft.com/v1/waitfornotification\"       \n}\n"
    kind: ConfigMap
    metadata:
      labels:
        app: ks-cloud-config
        tier: ks-control-plane
      name: ks-cloud-config
      namespace: kubescape
  3: |
    apiVersion: v1
    data:
      host-scanner-yaml: |2-
        apiVersion: apps/v1
        kind: DaemonSet
        metadata:
          name: host-scanner
          namespace: kubescape
          labels:
            app: host-scanner
            k8s-app: kubescape-host-scanner
        spec:
          selector:
            matchLabels:
              name: host-scanner
          template:
            metadata:
              labels:
                name: host-scanner
                otel: enabled
            spec:

              tolerations:
              - effect: NoSchedule
                key: node-role.kubernetes.io/control-plane
                operator: Exists
              - effect: NoSchedule
                key: node-role.kubernetes.io/master
                operator: Exists
              containers:
              - name: host-sensor
                image: "quay.io/kubescape/host-scanner:v1.0.65"
                imagePullPolicy: IfNotPresent
                securityContext:
                  allowPrivilegeEscalation: true
                  privileged: true
                  readOnlyRootFilesystem: true
                  procMount: Unmasked
                env:
                - name: KS_LOGGER_LEVEL
                  value: "info"
                - name: KS_LOGGER_NAME
                  value: "zap"
                - name: ACCOUNT_ID
                  value: "9e6c0c2c-6bd0-4919-815b-55030de7c9a0"
                - name: CLUSTER_NAME
                  value: "kind-kind"
                - name: OTEL_COLLECTOR_SVC
                  value: "otel-collector.kubescape.svc:4317"
                ports:
                  - name: scanner # Do not change port name
                    containerPort: 7888
                    protocol: TCP
                resources:
                  limits:
                    cpu: 0.4m
                    memory: 400Mi
                  requests:
                    cpu: 0.1m
                    memory: 200Mi
                volumeMounts:
                - mountPath: /host_fs
                  name: host-filesystem
                startupProbe:
                  httpGet:
                    path: /readyz
                    port: 7888
                  failureThreshold: 30
                  periodSeconds: 1
                livenessProbe:
                  httpGet:
                    path: /healthz
                    port: 7888
                  periodSeconds: 10
              terminationGracePeriodSeconds: 120
              dnsPolicy: ClusterFirstWithHostNet
              automountServiceAccountToken: false
              volumes:
              - hostPath:
                  path: /
                  type: Directory
                name: host-filesystem
              hostPID: true
              hostIPC: true
    kind: ConfigMap
    metadata:
      labels:
        app: ks-cloud-config
        tier: ks-control-plane
      name: host-scanner-definition
      namespace: kubescape
  4: |
    apiVersion: v1
    data:
      cronjobTemplate: "apiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: kubescape-scheduler\n  namespace: kubescape\n  labels:\n    app: kubescape-scheduler\n    tier: ks-control-plane\n    armo.tier: \"kubescape-scan\"\nspec:\n  schedule: \"0 8 * * *\"\n  jobTemplate:\n    spec:\n      template:\n        metadata:\n          labels:\n            armo.tier: \"kubescape-scan\"\n        spec:\n          containers:\n          - name: kubescape-scheduler\n            image: \"quay.io/kubescape/http-request:v0.0.14\"\n            imagePullPolicy: IfNotPresent\n            securityContext:\n              allowPrivilegeEscalation: false\n              readOnlyRootFilesystem: true\n              runAsNonRoot: true\n              runAsUser: 100\n            resources:\n              limits:\n                cpu: 10m\n                memory: 20Mi\n              requests:\n                cpu: 1m\n                memory: 10Mi\n            args: \n              - -method=post\n              - -scheme=http\n              - -host=operator:4002\n              - -path=v1/triggerAction\n              - -headers=\"Content-Type:application/json\"\n              - -path-body=/home/ks/request-body.json\n            volumeMounts:\n              - name: \"request-body-volume\"\n                mountPath: /home/ks/request-body.json\n                subPath: request-body.json\n                readOnly: true\n          restartPolicy: Never\n          automountServiceAccountToken: false\n          volumes:\n            - name: \"request-body-volume\" # placeholder\n              configMap:\n                name: kubescape-scheduler"
    kind: ConfigMap
    metadata:
      labels:
        app: ks-cloud-config
        tier: ks-control-plane
      name: kubescape-cronjob-template
      namespace: kubescape
  5: |
    apiVersion: v1
    data:
      cronjobTemplate: "apiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: kubevuln-scheduler\n  namespace: kubescape\n  labels:\n    app: kubevuln-scheduler\n    tier: ks-control-plane\n    armo.tier: \"vuln-scan\"\nspec:\n  schedule: \"0 0 * * *\" \n  jobTemplate:\n    spec:\n      template:\n        metadata:\n          labels:\n            armo.tier: \"vuln-scan\"\n        spec:\n          containers:\n          - name: kubevuln-scheduler\n            image: \"quay.io/kubescape/http-request:v0.0.14\"\n            imagePullPolicy: IfNotPresent\n            securityContext:\n              allowPrivilegeEscalation: false\n              readOnlyRootFilesystem: true\n              runAsNonRoot: true\n              runAsUser: 100\n            resources:\n              limits:\n                cpu: 10m\n                memory: 20Mi\n              requests:\n                cpu: 1m\n                memory: 10Mi\n            args: \n              - -method=post\n              - -scheme=http\n              - -host=operator:4002\n              - -path=v1/triggerAction\n              - -headers=\"Content-Type:application/json\"\n              - -path-body=/home/ks/request-body.json\n            volumeMounts:\n              - name: \"request-body-volume\"\n                mountPath: /home/ks/request-body.json\n                subPath: request-body.json\n                readOnly: true\n          restartPolicy: Never\n          automountServiceAccountToken: false\n          volumes:\n            - name: \"request-body-volume\" # placeholder\n              configMap:\n                name: kubevuln-scheduler"
    kind: ConfigMap
    metadata:
      labels:
        app: ks-cloud-config
        tier: ks-control-plane
      name: kubevuln-cronjob-template
      namespace: kubescape
  6: |
    apiVersion: v1
    data:
      otel-collector-config.yaml: |2-
        # receivers configure how data gets into the Collector.
        receivers:
          otlp:
            protocols:
              grpc:
              http:
          hostmetrics:
            collection_interval: 30s
            scrapers:
              cpu:
              memory:

        # processors specify what happens with the received data.
        processors:
          attributes/ksCloud:
            actions:
              - key: account_id
                value: "9e6c0c2c-6bd0-4919-815b-55030de7c9a0"
                action: upsert
              - key: cluster_name
                value: "kind-kind"
                action: upsert
          batch:
            send_batch_size: 10000
            timeout: 10s

        # exporters configure how to send processed data to one or more backends.
        exporters:
          otlp/ksCloud:
            endpoint: "otelcol.armosec.io:443"
            tls:
              insecure: false

        # service pulls the configured receivers, processors, and exporters together into
        # processing pipelines. Unused receivers/processors/exporters are ignored.
        service:
          pipelines:
            traces:
              receivers: [otlp]
              processors: [batch]
              exporters:
                - otlp/ksCloud
            metrics/2:
              receivers: [hostmetrics]
              processors: [attributes/ksCloud, batch]
              exporters:
                - otlp/ksCloud
            metrics:
              receivers: [otlp]
              processors: [batch]
              exporters:
                - otlp/ksCloud
            logs:
              receivers: [otlp]
              processors: [batch]
              exporters:
                - otlp/ksCloud
    kind: ConfigMap
    metadata:
      labels:
        app: ks-cloud-config
        tier: ks-control-plane
      name: otel-collector-config
      namespace: kubescape
  7: |
    apiVersion: v1
    data:
      cronjobTemplate: "apiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: registry-scheduler\n  namespace: kubescape\n  labels:\n    app: registry-scheduler\n    tier: ks-control-plane\n    armo.tier: \"registry-scan\"\nspec:\n  schedule: \"0 0 * * *\"\n  jobTemplate:\n    spec:\n      template:\n        metadata:\n          labels:\n            armo.tier: \"registry-scan\"\n        spec:\n          containers:\n          - name: registry-scheduler\n            image: \"quay.io/kubescape/http-request:v0.0.14\"\n            imagePullPolicy: IfNotPresent\n            securityContext:\n              allowPrivilegeEscalation: false\n              readOnlyRootFilesystem: true\n              runAsNonRoot: true\n              runAsUser: 100\n            resources:\n              limits:\n                cpu: 10m\n                memory: 20Mi\n              requests:\n                cpu: 1m\n                memory: 10Mi\n            args: \n              - -method=post\n              - -scheme=http\n              - -host=operator:4002\n              - -path=v1/triggerAction\n              - -headers=\"Content-Type:application/json\"\n              - -path-body=/home/ks/request-body.json\n            volumeMounts:\n              - name: \"request-body-volume\"\n                mountPath: /home/ks/request-body.json\n                subPath: request-body.json\n                readOnly: true\n          restartPolicy: Never\n          automountServiceAccountToken: false\n          volumes:\n            - name: \"request-body-volume\" # placeholder\n              configMap:\n                name: registry-scheduler"
    kind: ConfigMap
    metadata:
      labels:
        app: ks-cloud-config
        tier: ks-control-plane
      name: registry-scan-cronjob-template
      namespace: kubescape
  8: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: gateway
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/name: gateway
        helm.sh/chart: kubescape-cloud-operator-1.14.5
        tier: ks-control-plane
      name: gateway
      namespace: kubescape
    spec:
      replicas: 1
      revisionHistoryLimit: 2
      selector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: gateway
          tier: ks-control-plane
      strategy:
        rollingUpdate:
          maxSurge: 0%
          maxUnavailable: 100%
        type: RollingUpdate
      template:
        metadata:
          labels:
            app: gateway
            app.kubernetes.io/instance: RELEASE-NAME
            app.kubernetes.io/name: gateway
            helm.sh/chart: kubescape-cloud-operator-1.14.5
            helm.sh/revision: "0"
            tier: ks-control-plane
        spec:
          automountServiceAccountToken: false
          containers:
            - args:
                - -alsologtostderr
                - -v=4
                - 2>&1
              env:
                - name: GOMEMLIMIT
                  value: 30MiB
                - name: KS_LOGGER_LEVEL
                  value: info
                - name: KS_LOGGER_NAME
                  value: zap
                - name: WEBSOCKET_PORT
                  value: "8001"
                - name: HTTP_PORT
                  value: "8002"
                - name: ACCOUNT_ID
                  value: 9e6c0c2c-6bd0-4919-815b-55030de7c9a0
                - name: OTEL_COLLECTOR_SVC
                  value: otel-collector:4317
              image: quay.io/kubescape/gateway:v0.1.14
              imagePullPolicy: IfNotPresent
              livenessProbe:
                httpGet:
                  path: /v1/liveness
                  port: readiness-port
                initialDelaySeconds: 3
                periodSeconds: 3
              name: gateway
              ports:
                - containerPort: 8000
                  name: readiness-port
                  protocol: TCP
                - containerPort: 8001
                  name: websocket
                  protocol: TCP
                - containerPort: 8002
                  name: rest-api
                  protocol: TCP
              readinessProbe:
                httpGet:
                  path: /v1/readiness
                  port: readiness-port
                initialDelaySeconds: 10
                periodSeconds: 5
              resources:
                limits:
                  cpu: 100m
                  memory: 50Mi
                requests:
                  cpu: 10m
                  memory: 30Mi
              securityContext:
                allowPrivilegeEscalation: false
                readOnlyRootFilesystem: true
                runAsNonRoot: true
              volumeMounts:
                - mountPath: /etc/config
                  name: ks-cloud-config
                  readOnly: true
                - mountPath: /etc/ssl/certs/proxy.crt
                  name: proxy-secret
                  subPath: proxy.crt
          securityContext:
            fsGroup: 65532
            runAsUser: 65532
          volumes:
            - name: proxy-secret
              secret:
                secretName: kubescape-proxy-certificate
            - configMap:
                items:
                  - key: clusterData
                    path: clusterData.json
                name: ks-cloud-config
              name: ks-cloud-config
  9: |
    apiVersion: networking.k8s.io/v1
    kind: NetworkPolicy
    metadata:
      labels:
        app: gateway
        helm.sh/chart: kubescape-cloud-operator-1.14.5
        tier: ks-control-plane
      name: gateway
      namespace: kubescape
    spec:
      egress:
        - ports:
            - port: 443
              protocol: TCP
      ingress:
        - from:
            - podSelector:
                matchLabels:
                  app.kubernetes.io/instance: kubescape
                  app.kubernetes.io/name: operator
                  tier: ks-control-plane
          ports:
            - port: websocket
              protocol: TCP
      podSelector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: gateway
          tier: ks-control-plane
      policyTypes:
        - Ingress
        - Egress
  10: |
    apiVersion: v1
    kind: Service
    metadata:
      labels:
        app: gateway
      name: gateway
      namespace: kubescape
    spec:
      ports:
        - name: websocket
          port: 8001
          protocol: TCP
          targetPort: 8001
        - name: http
          port: 8002
          protocol: TCP
          targetPort: 8002
      selector:
        app: gateway
      type: ClusterIP
  11: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: grype-offline-db
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/name: grype-offline-db
        tier: ks-control-plane
      name: grype-offline-db
      namespace: kubescape
    spec:
      replicas: 1
      revisionHistoryLimit: 2
      selector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: grype-offline-db
          tier: ks-control-plane
      strategy:
        rollingUpdate:
          maxSurge: 0%
          maxUnavailable: 100%
        type: RollingUpdate
      template:
        metadata:
          labels:
            app: grype-offline-db
            app.kubernetes.io/instance: RELEASE-NAME
            app.kubernetes.io/name: grype-offline-db
            helm.sh/chart: kubescape-cloud-operator-1.14.5
            helm.sh/revision: "0"
            tier: ks-control-plane
        spec:
          containers:
            - image: ghcr.io/alexandreroman/grype-offline-db@sha256:155db3be4baa461a50cebadfc8f52108fca71aa4ce5e460a30a4e0922e899ed2
              imagePullPolicy: IfNotPresent
              name: grype-offline-db
              ports:
                - containerPort: 8080
                  protocol: TCP
              resources:
                limits:
                  cpu: 100m
                  memory: 200Mi
                requests:
                  cpu: 100m
                  memory: 200Mi
              securityContext:
                allowPrivilegeEscalation: false
                runAsNonRoot: true
  12: |
    apiVersion: networking.k8s.io/v1
    kind: NetworkPolicy
    metadata:
      labels:
        app: grype-offline-db
        tier: ks-control-plane
      name: grype-offline-db
      namespace: kubescape
    spec:
      ingress:
        - from:
            - podSelector:
                matchLabels:
                  app.kubernetes.io/instance: kubescape
                  app.kubernetes.io/name: kubevuln
                  tier: ks-control-plane
          ports:
            - port: 8080
              protocol: TCP
      podSelector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: grype-offline-db
          tier: ks-control-plane
      policyTypes:
        - Ingress
  13: |
    apiVersion: v1
    kind: Service
    metadata:
      labels:
        app: grype-offline-db
      name: grype-offline-db
      namespace: kubescape
    spec:
      ports:
        - port: 80
          protocol: TCP
          targetPort: 8080
      selector:
        app: grype-offline-db
      type: ClusterIP
  14: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRole
    metadata:
      name: kollector
    rules:
      - apiGroups:
          - ""
        resources:
          - pods
          - namespaces
          - cronjobs
          - secrets
          - nodes
          - services
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - apps
        resources:
          - deployments
          - statefulsets
          - daemonsets
          - replicasets
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - batch
        resources:
          - jobs
          - cronjobs
        verbs:
          - get
          - watch
          - list
  15: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRoleBinding
    metadata:
      name: kollector
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: ClusterRole
      name: kollector
    subjects:
      - kind: ServiceAccount
        name: kollector
        namespace: kubescape
  16: |
    apiVersion: networking.k8s.io/v1
    kind: NetworkPolicy
    metadata:
      labels:
        app: kollector
        tier: ks-control-plane
      name: kollector
      namespace: kubescape
    spec:
      egress:
        - ports:
            - port: 443
              protocol: TCP
        - ports:
            - port: 80
              protocol: TCP
          to:
            - ipBlock:
                cidr: 169.254.169.254/32
      podSelector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: kollector
          tier: ks-control-plane
      policyTypes:
        - Egress
  17: |
    apiVersion: v1
    automountServiceAccountToken: false
    kind: ServiceAccount
    metadata:
      labels:
        app: kollector
      name: kollector
      namespace: kubescape
  18: |
    apiVersion: apps/v1
    kind: StatefulSet
    metadata:
      labels:
        app: kollector
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/name: kollector
        tier: ks-control-plane
      name: kollector
      namespace: kubescape
    spec:
      replicas: 1
      selector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: kollector
          tier: ks-control-plane
      serviceName: ""
      template:
        metadata:
          labels:
            app: kollector
            app.kubernetes.io/instance: RELEASE-NAME
            app.kubernetes.io/name: kollector
            helm.sh/chart: kubescape-cloud-operator-1.14.5
            helm.sh/revision: "0"
            tier: ks-control-plane
        spec:
          automountServiceAccountToken: true
          containers:
            - args:
                - -alsologtostderr
                - -v=4
                - 2>&1
              env:
                - name: GOMEMLIMIT
                  value: 100MiB
                - name: KS_LOGGER_LEVEL
                  value: info
                - name: KS_LOGGER_NAME
                  value: zap
                - name: NAMESPACE
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.namespace
                - name: ACCOUNT_ID
                  value: 9e6c0c2c-6bd0-4919-815b-55030de7c9a0
                - name: OTEL_COLLECTOR_SVC
                  value: otel-collector:4317
                - name: PRINT_REPORT
                  value: "false"
                - name: WAIT_BEFORE_REPORT
                  value: "0"
              image: quay.io/kubescape/kollector:v0.1.24
              imagePullPolicy: IfNotPresent
              livenessProbe:
                httpGet:
                  path: /v1/liveness
                  port: readiness-port
                initialDelaySeconds: 3
                periodSeconds: 3
              name: kollector
              ports:
                - containerPort: 8000
                  name: readiness-port
                  protocol: TCP
              readinessProbe:
                httpGet:
                  path: /v1/readiness
                  port: readiness-port
                initialDelaySeconds: 10
                periodSeconds: 5
              resources:
                limits:
                  cpu: 500m
                  memory: 500Mi
                requests:
                  cpu: 10m
                  memory: 100Mi
              securityContext:
                allowPrivilegeEscalation: false
                readOnlyRootFilesystem: true
                runAsNonRoot: true
                runAsUser: 100
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /etc/config
                  name: ks-cloud-config
                  readOnly: true
                - mountPath: /etc/ssl/certs/proxy.crt
                  name: proxy-secret
                  subPath: proxy.crt
          serviceAccountName: kollector
          volumes:
            - name: proxy-secret
              secret:
                secretName: kubescape-proxy-certificate
            - emptyDir: {}
              name: tmp-dir
            - configMap:
                items:
                  - key: clusterData
                    path: clusterData.json
                name: ks-cloud-config
              name: ks-cloud-config
  19: |
    apiVersion: v1
    data:
      request-body.json: '{"commands":[{"CommandName":"kubescapeScan","args":{"scanV1": {}}}]}'
    kind: ConfigMap
    metadata:
      labels:
        app: kubescape-scheduler
        tier: ks-control-plane
      name: kubescape-scheduler
      namespace: kubescape
  20: |
    apiVersion: batch/v1
    kind: CronJob
    metadata:
      labels:
        app: kubescape-scheduler
        app.kubernetes.io/name: kubescape-scheduler
        armo.tier: kubescape-scan
        tier: ks-control-plane
      name: kubescape-scheduler
      namespace: kubescape
    spec:
      jobTemplate:
        spec:
          template:
            metadata:
              labels:
                app: kubescape-scheduler
                app.kubernetes.io/name: kubescape-scheduler
                armo.tier: kubescape-scan
            spec:
              automountServiceAccountToken: false
              containers:
                - args:
                    - -method=post
                    - -scheme=http
                    - -host=operator:4002
                    - -path=v1/triggerAction
                    - -headers="Content-Type:application/json"
                    - -path-body=/home/ks/request-body.json
                  image: quay.io/kubescape/http-request:v0.0.14
                  imagePullPolicy: IfNotPresent
                  name: kubescape-scheduler
                  resources:
                    limits:
                      cpu: 10m
                      memory: 20Mi
                    requests:
                      cpu: 1m
                      memory: 10Mi
                  securityContext:
                    allowPrivilegeEscalation: false
                    readOnlyRootFilesystem: true
                    runAsNonRoot: true
                    runAsUser: 100
                  volumeMounts:
                    - mountPath: /home/ks/request-body.json
                      name: kubescape-scheduler
                      readOnly: true
                      subPath: request-body.json
              restartPolicy: Never
              volumes:
                - configMap:
                    name: kubescape-scheduler
                  name: kubescape-scheduler
      schedule: 0 17 * * *
  21: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRole
    metadata:
      name: kubescape
    rules:
      - apiGroups:
          - ""
        resources:
          - pods
          - pods/proxy
          - namespaces
          - secrets
          - nodes
          - configmaps
          - services
          - serviceaccounts
          - endpoints
          - persistentvolumeclaims
          - limitranges
          - replicationcontrollers
          - podtemplates
          - resourcequotas
          - events
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - admissionregistration.k8s.io
        resources:
          - mutatingwebhookconfigurations
          - validatingwebhookconfigurations
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - apiregistration.k8s.io
        resources:
          - apiservices
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - apps
        resources:
          - deployments
          - statefulsets
          - daemonsets
          - replicasets
          - controllerrevisions
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - autoscaling
        resources:
          - horizontalpodautoscalers
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - batch
        resources:
          - jobs
          - cronjobs
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - coordination.k8s.io
        resources:
          - leases
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - discovery.k8s.io
        resources:
          - endpointslices
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - events.k8s.io
        resources:
          - events
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - hostdata.kubescape.cloud
        resources:
          - APIServerInfo
          - ControlPlaneInfo
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - networking.k8s.io
        resources:
          - networkpolicies
          - Ingress
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - policy
        resources:
          - poddisruptionbudgets
          - podsecuritypolicies
          - PodSecurityPolicy
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - rbac.authorization.k8s.io
        resources:
          - clusterroles
          - clusterrolebindings
          - roles
          - rolebindings
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - storage.k8s.io
        resources:
          - csistoragecapacities
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - networking.k8s.io
        resources:
          - ingresses
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - extensions
        resources:
          - Ingress
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - ""
        resources:
          - namespaces
        verbs:
          - update
  22: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRoleBinding
    metadata:
      name: kubescape
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: ClusterRole
      name: kubescape
    subjects:
      - kind: ServiceAccount
        name: kubescape
        namespace: kubescape
  23: |
    apiVersion: v1
    data:
      config.json: |
        {
          "accountID": "9e6c0c2c-6bd0-4919-815b-55030de7c9a0",
          "cloudReportURL": "",
          "cloudAPIURL": "",
          "cloudUIURL": "",
          "cloudAuthURL": "",
          "clusterName": "kind-kind",
          "clientID": "",
          "secretKey": ""
        }
    kind: ConfigMap
    metadata:
      labels:
        app: kubescape-config
        tier: ks-control-plane
      name: kubescape-config
      namespace: kubescape
  24: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: kubescape
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/name: kubescape
        helm.sh/chart: kubescape-cloud-operator-1.14.5
        tier: ks-control-plane
      name: kubescape
      namespace: kubescape
    spec:
      replicas: 1
      revisionHistoryLimit: 2
      selector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: kubescape
          tier: ks-control-plane
      strategy:
        rollingUpdate:
          maxSurge: 0%
          maxUnavailable: 100%
        type: RollingUpdate
      template:
        metadata:
          labels:
            app: kubescape
            app.kubernetes.io/instance: RELEASE-NAME
            app.kubernetes.io/name: kubescape
            helm.sh/chart: kubescape-cloud-operator-1.14.5
            helm.sh/revision: "0"
            otel: enabled
            tier: ks-control-plane
        spec:
          automountServiceAccountToken: true
          containers:
            - command:
                - ksserver
              env:
                - name: GOMEMLIMIT
                  value: 400MiB
                - name: CLUSTER_NAME
                  value: kind-kind
                - name: KS_LOGGER_LEVEL
                  value: info
                - name: KS_LOGGER_NAME
                  value: zap
                - name: KS_DOWNLOAD_ARTIFACTS
                  value: "true"
                - name: RULE_PROCESSING_GOMAXPROCS
                  value: ""
                - name: KS_DEFAULT_CONFIGMAP_NAME
                  value: kubescape-config
                - name: KS_DEFAULT_CONFIGMAP_NAMESPACE
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.namespace
                - name: KS_CONTEXT
                  value: kind-kind
                - name: KS_ENABLE_HOST_SCANNER
                  value: "true"
                - name: KS_SUBMIT
                  value: "true"
                - name: KS_SKIP_UPDATE_CHECK
                  value: "false"
                - name: KS_HOST_SCAN_YAML
                  value: /home/nonroot/.kubescape/host-scanner.yaml
                - name: LARGE_CLUSTER_SIZE
                  value: "1500"
                - name: KS_SAAS_ENV
                  value: ""
                - name: ACCOUNT_ID
                  value: 9e6c0c2c-6bd0-4919-815b-55030de7c9a0
                - name: OTEL_COLLECTOR_SVC
                  value: otel-collector:4317
              image: quay.io/kubescape/kubescape:v2.9.0
              imagePullPolicy: IfNotPresent
              livenessProbe:
                httpGet:
                  path: /livez
                  port: 8080
                initialDelaySeconds: 3
                periodSeconds: 3
              name: kubescape
              ports:
                - containerPort: 8080
                  name: http
                  protocol: TCP
              readinessProbe:
                httpGet:
                  path: /readyz
                  port: 8080
                initialDelaySeconds: 3
                periodSeconds: 3
              resources:
                limits:
                  cpu: 600m
                  memory: 1Gi
                requests:
                  cpu: 250m
                  memory: 400Mi
              securityContext:
                allowPrivilegeEscalation: false
                runAsUser: 0
              volumeMounts:
                - mountPath: /home/nonroot/.kubescape/config.json
                  name: kubescape-config-volume
                  subPath: config.json
                - mountPath: /home/nonroot/.kubescape/host-scanner.yaml
                  name: host-scanner-definition
                  subPath: host-scanner-yaml
                - mountPath: /home/nonroot/results
                  name: results
                - mountPath: /home/nonroot/failed
                  name: failed
                - mountPath: /etc/ssl/certs/proxy.crt
                  name: proxy-secret
                  subPath: proxy.crt
          serviceAccountName: kubescape
          volumes:
            - name: proxy-secret
              secret:
                secretName: kubescape-proxy-certificate
            - configMap:
                name: kubescape-config
              name: kubescape-config-volume
            - configMap:
                name: host-scanner-definition
              name: host-scanner-definition
            - emptyDir: {}
              name: results
            - emptyDir: {}
              name: failed
  25: |
    apiVersion: networking.k8s.io/v1
    kind: NetworkPolicy
    metadata:
      labels:
        app: kubescape
        helm.sh/chart: kubescape-cloud-operator-1.14.5
        tier: ks-control-plane
      name: kubescape
      namespace: kubescape
    spec:
      egress:
        - ports:
            - port: 443
              protocol: TCP
      ingress:
        - from:
            - podSelector:
                matchLabels:
                  app.kubernetes.io/instance: kubescape
                  app.kubernetes.io/name: operator
                  tier: ks-control-plane
          ports:
            - port: http
              protocol: TCP
      podSelector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: kubescape
          tier: ks-control-plane
      policyTypes:
        - Ingress
        - Egress
  26: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: Role
    metadata:
      name: kubescape
      namespace: kubescape
    rules:
      - apiGroups:
          - apps
        resources:
          - daemonsets
        verbs:
          - create
          - get
          - update
          - watch
          - list
          - patch
          - delete
  27: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: RoleBinding
    metadata:
      name: kubescape
      namespace: kubescape
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: Role
      name: kubescape
    subjects:
      - kind: ServiceAccount
        name: kubescape
        namespace: kubescape
  28: |
    apiVersion: v1
    kind: Service
    metadata:
      labels:
        app: kubescape
      name: kubescape
      namespace: kubescape
    spec:
      ports:
        - name: http
          port: 8080
          protocol: TCP
          targetPort: 8080
      selector:
        app: kubescape
      type: ClusterIP
  29: |
    apiVersion: v1
    automountServiceAccountToken: false
    kind: ServiceAccount
    metadata:
      labels:
        app: kubescape
      name: kubescape
      namespace: kubescape
  30: |
    apiVersion: monitoring.coreos.com/v1
    kind: ServiceMonitor
    metadata:
      labels:
        app: kubescape
        helm.sh/chart: kubescape-cloud-operator-1.14.5
      name: kubescape-monitor
      namespace: kubescape
    spec:
      endpoints:
        - interval: 200s
          path: /v1/metrics
          port: http
          scrapeTimeout: 150s
      namespaceSelector:
        matchNames:
          - kubescape
      selector:
        matchLabels:
          app: kubescape
  31: |
    apiVersion: v1
    data:
      request-body.json: '{"commands":[{"commandName":"scan","designators":[{"designatorType":"Attributes","attributes":{}}]}]}'
    kind: ConfigMap
    metadata:
      labels:
        app: kubevuln-scheduler
        tier: ks-control-plane
      name: kubevuln-scheduler
      namespace: kubescape
  32: |
    apiVersion: batch/v1
    kind: CronJob
    metadata:
      labels:
        app: kubevuln-scheduler
        app.kubernetes.io/name: kubevuln-scheduler
        armo.tier: vuln-scan
        tier: ks-control-plane
      name: kubevuln-scheduler
      namespace: kubescape
    spec:
      jobTemplate:
        spec:
          template:
            metadata:
              labels:
                app: kubevuln-scheduler
                app.kubernetes.io/name: kubevuln-scheduler
                armo.tier: vuln-scan
            spec:
              automountServiceAccountToken: false
              containers:
                - args:
                    - -method=post
                    - -scheme=http
                    - -host=operator:4002
                    - -path=v1/triggerAction
                    - -headers="Content-Type:application/json"
                    - -path-body=/home/ks/request-body.json
                  image: quay.io/kubescape/http-request:v0.0.14
                  imagePullPolicy: IfNotPresent
                  name: kubevuln-scheduler
                  resources:
                    limits:
                      cpu: 10m
                      memory: 20Mi
                    requests:
                      cpu: 1m
                      memory: 10Mi
                  securityContext:
                    allowPrivilegeEscalation: false
                    readOnlyRootFilesystem: true
                    runAsNonRoot: true
                    runAsUser: 100
                  volumeMounts:
                    - mountPath: /home/ks/request-body.json
                      name: kubevuln-scheduler
                      readOnly: true
                      subPath: request-body.json
              restartPolicy: Never
              volumes:
                - configMap:
                    name: kubevuln-scheduler
                  name: kubevuln-scheduler
      schedule: 30 9 * * *
  33: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: kubevuln
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/name: kubevuln
        tier: ks-control-plane
      name: kubevuln
      namespace: kubescape
    spec:
      replicas: 1
      revisionHistoryLimit: 2
      selector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: kubevuln
          tier: ks-control-plane
      strategy:
        type: Recreate
      template:
        metadata:
          labels:
            app: kubevuln
            app.kubernetes.io/instance: RELEASE-NAME
            app.kubernetes.io/name: kubevuln
            helm.sh/chart: kubescape-cloud-operator-1.14.5
            helm.sh/revision: "0"
            otel: enabled
            tier: ks-control-plane
        spec:
          automountServiceAccountToken: true
          containers:
            - args:
                - -alsologtostderr
                - -v=4
                - 2>&1
              env:
                - name: GOMEMLIMIT
                  value: 1000MiB
                - name: KS_LOGGER_LEVEL
                  value: info
                - name: KS_LOGGER_NAME
                  value: zap
                - name: PRINT_POST_JSON
                  value: ""
                - name: CA_MAX_VULN_SCAN_ROUTINES
                  value: "1"
                - name: ACCOUNT_ID
                  value: 9e6c0c2c-6bd0-4919-815b-55030de7c9a0
                - name: OTEL_COLLECTOR_SVC
                  value: otel-collector:4317
              image: quay.io/kubescape/kubevuln:v0.2.104
              imagePullPolicy: IfNotPresent
              livenessProbe:
                httpGet:
                  path: /v1/liveness
                  port: 8080
                initialDelaySeconds: 3
                periodSeconds: 3
              name: kubevuln
              ports:
                - containerPort: 8080
                  protocol: TCP
              readinessProbe:
                httpGet:
                  path: /v1/readiness
                  port: 8080
              resources:
                limits:
                  cpu: 1500m
                  ephemeral-storage: 6Gi
                  memory: 5000Mi
                requests:
                  cpu: 300m
                  ephemeral-storage: 5Gi
                  memory: 1000Mi
              securityContext:
                allowPrivilegeEscalation: false
                readOnlyRootFilesystem: true
                runAsNonRoot: true
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /home/nonroot/anchore-resources/db
                  name: grype-db-cache
                - mountPath: /etc/config
                  name: ks-cloud-config
                  readOnly: true
                - mountPath: /home/nonroot/.cache/grype
                  name: grype-db
                - mountPath: /etc/ssl/certs/proxy.crt
                  name: proxy-secret
                  subPath: proxy.crt
          securityContext:
            fsGroup: 65532
            runAsUser: 65532
          serviceAccountName: kubevuln
          volumes:
            - name: proxy-secret
              secret:
                secretName: kubescape-proxy-certificate
            - emptyDir: {}
              name: tmp-dir
            - emptyDir: {}
              name: grype-db-cache
            - configMap:
                items:
                  - key: clusterData
                    path: clusterData.json
                name: ks-cloud-config
              name: ks-cloud-config
            - emptyDir: {}
              name: grype-db
  34: |
    apiVersion: networking.k8s.io/v1
    kind: NetworkPolicy
    metadata:
      labels:
        app: kubevuln
        tier: ks-control-plane
      name: kubevuln
      namespace: kubescape
    spec:
      egress:
        - ports:
            - port: 443
              protocol: TCP
      ingress:
        - from:
            - podSelector:
                matchLabels:
                  app.kubernetes.io/instance: kubescape
                  app.kubernetes.io/name: operator
                  tier: ks-control-plane
          ports:
            - port: 8080
              protocol: TCP
      podSelector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: kubevuln
          tier: ks-control-plane
      policyTypes:
        - Ingress
        - Egress
  35: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: Role
    metadata:
      name: kubevuln
      namespace: kubescape
    rules:
      - apiGroups:
          - spdx.softwarecomposition.kubescape.io
        resources:
          - sbomspdxv2p3s
          - vulnerabilitymanifests
          - sbomsummaries
          - vulnerabilitymanifestsummaries
        verbs:
          - create
          - get
          - update
          - watch
          - list
          - patch
      - apiGroups:
          - spdx.softwarecomposition.kubescape.io
        resources:
          - sbomspdxv2p3filtereds
        verbs:
          - get
          - watch
          - list
  36: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: RoleBinding
    metadata:
      name: kubevuln
      namespace: kubescape
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: Role
      name: kubevuln
    subjects:
      - kind: ServiceAccount
        name: kubevuln
        namespace: kubescape
  37: |
    apiVersion: v1
    kind: Service
    metadata:
      labels:
        app: kubevuln
      name: kubevuln
      namespace: kubescape
    spec:
      ports:
        - port: 8080
          protocol: TCP
          targetPort: 8080
      selector:
        app: kubevuln
      type: ClusterIP
  38: |
    apiVersion: v1
    automountServiceAccountToken: false
    kind: ServiceAccount
    metadata:
      labels:
        app: kubevuln
      name: kubevuln
      namespace: kubescape
  39: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRole
    metadata:
      name: node-agent
    rules:
      - apiGroups:
          - ""
        resources:
          - pods
          - nodes
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - ""
        resources:
          - events
        verbs:
          - list
          - watch
          - create
      - apiGroups:
          - batch
        resources:
          - jobs
          - cronjobs
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - apps
        resources:
          - deployments
          - daemonsets
          - statefulsets
          - replicasets
        verbs:
          - get
          - watch
          - list
  40: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRoleBinding
    metadata:
      name: node-agent
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: ClusterRole
      name: node-agent
    subjects:
      - kind: ServiceAccount
        name: node-agent
        namespace: kubescape
  41: |
    apiVersion: v1
    data:
      config.json: |
        {
            "relevantCVEServiceEnabled": true,
            "InitialDelay": "2m",
            "updateDataPeriod": "10m",
            "maxSniffingTimePerContainer": "3h"
        }
    kind: ConfigMap
    metadata:
      name: node-agent
      namespace: kubescape
  42: |
    apiVersion: apps/v1
    kind: DaemonSet
    metadata:
      labels:
        app: node-agent
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/name: node-agent
        tier: ks-control-plane
      name: node-agent
      namespace: kubescape
    spec:
      selector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: node-agent
          tier: ks-control-plane
      template:
        metadata:
          labels:
            alt-name: node-agent
            app: node-agent
            app.kubernetes.io/instance: RELEASE-NAME
            app.kubernetes.io/name: node-agent
            helm.sh/chart: kubescape-cloud-operator-1.14.5
            helm.sh/revision: "0"
            otel: enabled
            tier: ks-control-plane
        spec:
          affinity:
            nodeAffinity:
              requiredDuringSchedulingIgnoredDuringExecution:
                nodeSelectorTerms:
                  - matchExpressions:
                      - key: kubernetes.io/os
                        operator: In
                        values:
                          - linux
          automountServiceAccountToken: true
          containers:
            - env:
                - name: GOMEMLIMIT
                  value: 600MiB
                - name: KS_LOGGER_LEVEL
                  value: info
                - name: KS_LOGGER_NAME
                  value: zap
                - name: OTEL_COLLECTOR_SVC
                  value: otel-collector:4317
                - name: NODE_NAME
                  valueFrom:
                    fieldRef:
                      fieldPath: spec.nodeName
                - name: POD_NAME
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.name
                - name: HOST_ROOT
                  value: /host
                - name: NodeName
              image: quay.io/kubescape/node-agent:v0.1.96
              imagePullPolicy: IfNotPresent
              name: node-agent
              resources:
                limits:
                  cpu: 500m
                  memory: 700Mi
                requests:
                  cpu: 100m
                  memory: 180Mi
              securityContext:
                capabilities:
                  add:
                    - SYS_ADMIN
                privileged: true
                runAsUser: 0
              volumeMounts:
                - mountPath: /etc/config/clusterData.json
                  name: ks-cloud-config
                  readOnly: true
                  subPath: clusterData.json
                - mountPath: /etc/config/config.json
                  name: config
                  readOnly: true
                  subPath: config.json
                - mountPath: /host
                  name: host
                - mountPath: /run
                  name: run
                - mountPath: /lib/modules
                  name: modules
                - mountPath: /sys/kernel/debug
                  name: debugfs
                - mountPath: /sys/fs/cgroup
                  name: cgroup
                - mountPath: /sys/fs/bpf
                  name: bpffs
                - mountPath: /data
                  name: data
                - mountPath: /etc/ssl/certs/proxy.crt
                  name: proxy-secret
                  subPath: proxy.crt
          hostPID: true
          nodeSelector:
            kubernetes.io/arch: amd64
            kubernetes.io/os: linux
          serviceAccountName: node-agent
          volumes:
            - configMap:
                items:
                  - key: clusterData
                    path: clusterData.json
                name: ks-cloud-config
              name: ks-cloud-config
            - configMap:
                items:
                  - key: config.json
                    path: config.json
                name: node-agent
              name: config
            - hostPath:
                path: /
                type: null
              name: host
            - hostPath:
                path: /run
                type: null
              name: run
            - hostPath:
                path: /sys/fs/cgroup
                type: null
              name: cgroup
            - hostPath:
                path: /lib/modules
                type: null
              name: modules
            - hostPath:
                path: /sys/fs/bpf
                type: null
              name: bpffs
            - hostPath:
                path: /sys/kernel/debug
                type: null
              name: debugfs
            - name: data
            - name: proxy-secret
              secret:
                secretName: kubescape-proxy-certificate
  43: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: Role
    metadata:
      name: node-agent
      namespace: kubescape
    rules:
      - apiGroups:
          - spdx.softwarecomposition.kubescape.io
        resources:
          - sbomspdxv2p3s
          - sbomsummaries
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - spdx.softwarecomposition.kubescape.io
        resources:
          - sbomspdxv2p3filtereds
        verbs:
          - create
          - get
          - update
          - watch
          - list
          - patch
  44: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: RoleBinding
    metadata:
      name: node-agent
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: Role
      name: node-agent
    subjects:
      - kind: ServiceAccount
        name: node-agent
        namespace: kubescape
  45: |
    apiVersion: v1
    kind: ServiceAccount
    metadata:
      name: node-agent
      namespace: kubescape
  46: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRole
    metadata:
      name: operator
    rules:
      - apiGroups:
          - ""
        resources:
          - pods
          - nodes
          - namespaces
          - configmaps
          - secrets
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - batch
        resources:
          - jobs
          - cronjobs
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - apps
        resources:
          - deployments
          - daemonsets
          - statefulsets
          - replicasets
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - spdx.softwarecomposition.kubescape.io
        resources:
          - sbomspdxv2p3s
          - sbomspdxv2p3filtereds
          - vulnerabilitymanifests
          - sbomsummaries
          - vulnerabilitymanifestsummaries
        verbs:
          - get
          - watch
          - list
          - delete
  47: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRoleBinding
    metadata:
      name: operator
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: ClusterRole
      name: operator
    subjects:
      - kind: ServiceAccount
        name: operator
        namespace: kubescape
  48: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: operator
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/name: operator
        tier: ks-control-plane
      name: operator
      namespace: kubescape
    spec:
      replicas: 1
      revisionHistoryLimit: 2
      selector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: operator
          tier: ks-control-plane
      strategy:
        rollingUpdate:
          maxSurge: 0%
          maxUnavailable: 100%
        type: RollingUpdate
      template:
        metadata:
          labels:
            app: operator
            app.kubernetes.io/instance: RELEASE-NAME
            app.kubernetes.io/name: operator
            helm.sh/chart: kubescape-cloud-operator-1.14.5
            helm.sh/revision: "0"
            otel: enabled
            tier: ks-control-plane
        spec:
          automountServiceAccountToken: true
          containers:
            - args:
                - -alsologtostderr
                - -v=4
                - 2>&1
              env:
                - name: GOMEMLIMIT
                  value: 100MiB
                - name: KS_LOGGER_LEVEL
                  value: info
                - name: KS_LOGGER_NAME
                  value: zap
                - name: NAMESPACE
                  valueFrom:
                    fieldRef:
                      fieldPath: metadata.namespace
                - name: ACCOUNT_ID
                  value: 9e6c0c2c-6bd0-4919-815b-55030de7c9a0
                - name: OTEL_COLLECTOR_SVC
                  value: otel-collector:4317
                - name: TRIGGER_SECURITY_FRAMEWORK
                  value: "true"
              image: quay.io/kubescape/operator:v0.1.39
              imagePullPolicy: IfNotPresent
              livenessProbe:
                httpGet:
                  path: /v1/liveness
                  port: readiness-port
                initialDelaySeconds: 3
                periodSeconds: 3
              name: operator
              ports:
                - containerPort: 4002
                  name: trigger-port
                  protocol: TCP
                - containerPort: 8000
                  name: readiness-port
                  protocol: TCP
              readinessProbe:
                httpGet:
                  path: /v1/readiness
                  port: readiness-port
                initialDelaySeconds: 10
                periodSeconds: 5
              resources:
                limits:
                  cpu: 300m
                  memory: 300Mi
                requests:
                  cpu: 50m
                  memory: 100Mi
              securityContext:
                allowPrivilegeEscalation: false
                readOnlyRootFilesystem: true
                runAsNonRoot: true
              volumeMounts:
                - mountPath: /tmp
                  name: tmp-dir
                - mountPath: /etc/config
                  name: ks-cloud-config
                  readOnly: true
                - mountPath: /etc/ssl/certs/proxy.crt
                  name: proxy-secret
                  subPath: proxy.crt
          securityContext:
            fsGroup: 65532
            runAsUser: 65532
          serviceAccountName: operator
          volumes:
            - name: proxy-secret
              secret:
                secretName: kubescape-proxy-certificate
            - emptyDir: {}
              name: tmp-dir
            - configMap:
                items:
                  - key: clusterData
                    path: clusterData.json
                name: ks-cloud-config
              name: ks-cloud-config
  49: |
    apiVersion: networking.k8s.io/v1
    kind: NetworkPolicy
    metadata:
      labels:
        app: operator
        tier: ks-control-plane
      name: operator
      namespace: kubescape
    spec:
      egress:
        - ports:
            - port: 443
              protocol: TCP
        - ports:
            - port: 80
              protocol: TCP
          to:
            - ipBlock:
                cidr: 169.254.169.254/32
      ingress:
        - from:
            - podSelector:
                matchLabels:
                  armo.tier: kubescape-scan
            - podSelector:
                matchLabels:
                  armo.tier: vuln-scan
          ports:
            - port: trigger-port
              protocol: TCP
      podSelector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: operator
          tier: ks-control-plane
      policyTypes:
        - Ingress
        - Egress
  50: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: Role
    metadata:
      name: operator
      namespace: kubescape
    rules:
      - apiGroups:
          - ""
        resources:
          - configmaps
          - secrets
        verbs:
          - create
          - get
          - update
          - watch
          - list
          - patch
          - delete
      - apiGroups:
          - batch
        resources:
          - cronjobs
        verbs:
          - create
          - get
          - update
          - watch
          - list
          - patch
          - delete
  51: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: RoleBinding
    metadata:
      name: operator
      namespace: kubescape
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: Role
      name: operator
    subjects:
      - kind: ServiceAccount
        name: operator
        namespace: kubescape
  52: |
    apiVersion: v1
    kind: Service
    metadata:
      labels:
        app: operator
      name: operator
      namespace: kubescape
    spec:
      ports:
        - port: 4002
          protocol: TCP
          targetPort: 4002
      selector:
        app: operator
      type: ClusterIP
  53: |
    apiVersion: v1
    automountServiceAccountToken: false
    kind: ServiceAccount
    metadata:
      labels:
        app: operator
      name: operator
      namespace: kubescape
  54: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app: otel-collector
        app.kubernetes.io/instance: RELEASE-NAME
        app.kubernetes.io/name: otel-collector
        helm.sh/chart: kubescape-cloud-operator-1.14.5
        tier: ks-control-plane
      name: otel-collector
      namespace: kubescape
    spec:
      replicas: 1
      revisionHistoryLimit: 2
      selector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: otel-collector
          tier: ks-control-plane
      strategy:
        rollingUpdate:
          maxSurge: 0%
          maxUnavailable: 100%
        type: RollingUpdate
      template:
        metadata:
          labels:
            app: otel-collector
            app.kubernetes.io/instance: RELEASE-NAME
            app.kubernetes.io/name: otel-collector
            helm.sh/chart: kubescape-cloud-operator-1.14.5
            helm.sh/revision: "0"
            tier: ks-control-plane
        spec:
          containers:
            - command:
                - /otelcol
                - --config=/conf/otel-collector-config.yaml
              env:
                - name: GOMEMLIMIT
                  value: 500MiB
                - name: GOGC
                  value: "80"
              image: otel/opentelemetry-collector:0.81.0
              imagePullPolicy: IfNotPresent
              name: otel-collector
              ports:
                - containerPort: 4317
                  name: otlp
                  protocol: TCP
              resources:
                limits:
                  cpu: 1
                  memory: 1Gi
                requests:
                  cpu: 100m
                  memory: 500Mi
              securityContext:
                allowPrivilegeEscalation: false
                runAsNonRoot: true
                runAsUser: 100
              volumeMounts:
                - mountPath: /conf
                  name: otel-collector-config-volume
                - mountPath: /etc/ssl/certs/proxy.crt
                  name: proxy-secret
                  subPath: proxy.crt
          serviceAccountName: default
          volumes:
            - name: proxy-secret
              secret:
                secretName: kubescape-proxy-certificate
            - configMap:
                name: otel-collector-config
              name: otel-collector-config-volume
  55: |
    apiVersion: networking.k8s.io/v1
    kind: NetworkPolicy
    metadata:
      labels:
        app: otel-collector
        helm.sh/chart: kubescape-cloud-operator-1.14.5
        tier: ks-control-plane
      name: otel-collector
      namespace: kubescape
    spec:
      egress:
        - ports:
            - port: 4317
              protocol: TCP
      ingress:
        - from:
            - podSelector:
                matchLabels:
                  otel: enabled
          ports:
            - port: otlp
              protocol: TCP
      podSelector:
        matchLabels:
          app.kubernetes.io/instance: RELEASE-NAME
          app.kubernetes.io/name: otel-collector
          tier: ks-control-plane
      policyTypes:
        - Ingress
        - Egress
  56: |
    apiVersion: v1
    kind: Service
    metadata:
      labels:
        app: otel-collector
      name: otel-collector
      namespace: kubescape
    spec:
      ports:
        - name: otlp
          port: 4317
          protocol: TCP
          targetPort: 4317
      selector:
        app: otel-collector
      type: ClusterIP
  57: |
    apiVersion: v1
    data:
      proxy.crt: foo
    kind: Secret
    metadata:
      name: kubescape-proxy-certificate
      namespace: kubescape
    type: Opaque
  58: |
    apiVersion: apiregistration.k8s.io/v1
    kind: APIService
    metadata:
      name: v1beta1.spdx.softwarecomposition.kubescape.io
    spec:
      group: spdx.softwarecomposition.kubescape.io
      groupPriorityMinimum: 1000
      insecureSkipTLSVerify: true
      service:
        name: storage
        namespace: kubescape
      version: v1beta1
      versionPriority: 15
  59: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRole
    metadata:
      name: storage
    rules:
      - apiGroups:
          - ""
        resources:
          - namespaces
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - admissionregistration.k8s.io
        resources:
          - mutatingwebhookconfigurations
          - validatingwebhookconfigurations
        verbs:
          - get
          - watch
          - list
      - apiGroups:
          - flowcontrol.apiserver.k8s.io
        resources:
          - prioritylevelconfigurations
          - flowschemas
        verbs:
          - get
          - watch
          - list
  60: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRoleBinding
    metadata:
      name: storage:system:auth-delegator
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: ClusterRole
      name: system:auth-delegator
    subjects:
      - kind: ServiceAccount
        name: storage
        namespace: kubescape
  61: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: ClusterRoleBinding
    metadata:
      name: storage
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: ClusterRole
      name: storage
    subjects:
      - kind: ServiceAccount
        name: storage
        namespace: kubescape
  62: |
    apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        app.kubernetes.io/component: apiserver
        app.kubernetes.io/name: storage
        app.kubernetes.io/part-of: kubescape-storage
      name: storage
      namespace: kubescape
    spec:
      replicas: 1
      revisionHistoryLimit: 2
      selector:
        matchLabels:
          app.kubernetes.io/component: apiserver
          app.kubernetes.io/name: storage
          app.kubernetes.io/part-of: kubescape-storage
      strategy:
        type: Recreate
      template:
        metadata:
          labels:
            app.kubernetes.io/component: apiserver
            app.kubernetes.io/name: storage
            app.kubernetes.io/part-of: kubescape-storage
            otel: enabled
        spec:
          containers:
            - env:
                - name: GOMEMLIMIT
                  value: 400MiB
                - name: OTEL_COLLECTOR_SVC
                  value: otel-collector:4317
              image: quay.io/kubescape/storage:v0.0.12
              imagePullPolicy: IfNotPresent
              name: apiserver
              resources:
                limits:
                  cpu: 150m
                  memory: 1500Mi
                requests:
                  cpu: 50m
                  memory: 400Mi
              securityContext:
                allowPrivilegeEscalation: false
                runAsNonRoot: true
              volumeMounts:
                - mountPath: /data
                  name: data
                - mountPath: /etc/config
                  name: ks-cloud-config
                  readOnly: true
          initContainers:
            - command:
                - sh
                - -c
                - chown -Rc 65532:65532 /data
              image: busybox
              imagePullPolicy: IfNotPresent
              name: fix-permissions
              securityContext:
                runAsUser: 0
              volumeMounts:
                - mountPath: /data
                  name: data
          securityContext:
            fsGroup: 65532
            runAsUser: 65532
          serviceAccountName: storage
          volumes:
            - name: data
              persistentVolumeClaim:
                claimName: storage
            - configMap:
                items:
                  - key: clusterData
                    path: clusterData.json
                name: ks-cloud-config
              name: ks-cloud-config
  63: |
    apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      labels:
        app.kubernetes.io/component: apiserver
        app.kubernetes.io/name: storage
        app.kubernetes.io/part-of: kubescape-storage
      name: storage
      namespace: kubescape
    spec:
      accessModes:
        - ReadWriteOnce
      resources:
        requests:
          storage: 5Gi
  64: |
    apiVersion: rbac.authorization.k8s.io/v1
    kind: RoleBinding
    metadata:
      name: storage-auth-reader
      namespace: kube-system
    roleRef:
      apiGroup: rbac.authorization.k8s.io
      kind: Role
      name: extension-apiserver-authentication-reader
    subjects:
      - kind: ServiceAccount
        name: storage
        namespace: kubescape
  65: |
    apiVersion: v1
    kind: Service
    metadata:
      name: storage
      namespace: kubescape
    spec:
      ports:
        - port: 443
          protocol: TCP
          targetPort: 8443
      selector:
        app.kubernetes.io/component: apiserver
        app.kubernetes.io/name: storage
        app.kubernetes.io/part-of: kubescape-storage
  66: |
    apiVersion: v1
    kind: ServiceAccount
    metadata:
      name: storage
      namespace: kubescape
